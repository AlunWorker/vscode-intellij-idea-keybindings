# Cursor Rules for IntelliJ IDEA Keybindings VS Code Extension

## 重要说明
**始终用中文回复** - 所有代码注释、文档、用户交互和错误消息都应使用中文。

## Project Overview
This is a VS Code extension that ports IntelliJ IDEA keybindings to VS Code. The project converts IntelliJ XML keymap files to VS Code JSON keybindings format.

## Architecture
- **Main Entry**: `src/extension.ts` - Extension activation and command registration
- **Core Logic**: `src/importer/` - Contains all keybinding conversion logic
  - `model/` - Data models and interfaces
  - `parser/` - XML/JSON parsing logic
  - `reader/` - File reading and user input handling
  - `writer/` - File output and VS Code integration
  - `generator/` - JSON generation for VS Code keybindings
  - `syntax-analyzer/` - Core conversion logic
  - `extension/` - VS Code extension-specific functionality

## Code Style & Standards

### TypeScript
- Use strict TypeScript configuration (already configured in tsconfig.json)
- Prefer explicit typing over `any` - use proper interfaces and types
- Use `eslint-disable-next-line` comments sparingly and only when necessary
- Follow the existing naming conventions:
  - PascalCase for classes and interfaces
  - camelCase for variables and functions
  - UPPER_SNAKE_CASE for constants

### VS Code Extension Development
- Import `vscode` as `* as vscode` at the top of files
- Register commands in the `activate` function using `context.subscriptions.push()`
- Use async/await for VS Code API calls
- Follow VS Code extension lifecycle patterns
- Use proper error handling for file operations and user interactions

### File Organization
- Keep related functionality in the same directory
- Use descriptive file names that reflect their purpose
- Maintain the existing directory structure in `src/importer/`
- Place utility functions in appropriate modules

### Error Handling
- Use try-catch blocks for file operations
- Provide meaningful error messages to users in Chinese
- Handle edge cases gracefully (e.g., file not found, invalid XML)
- Use VS Code's notification system for user feedback
- All error messages and user-facing text should be in Chinese

### Performance
- Avoid synchronous file operations in the main thread
- Use async file reading/writing
- Minimize memory usage when processing large XML files
- Consider streaming for very large files

## Development Guidelines

### Adding New Features
1. Follow the existing architecture pattern
2. Add proper TypeScript interfaces for new data structures
3. Update the main extension.ts if adding new commands
4. Add appropriate error handling
5. Update package.json if adding new dependencies

### Testing
- Test with various IntelliJ XML keymap files
- Verify conversion accuracy
- Test error scenarios (invalid files, missing files)
- Test cross-platform compatibility (Windows, macOS, Linux)

### Documentation
- Add JSDoc comments for public functions in Chinese
- Update README.md for new features
- Document any breaking changes in CHANGELOG.md
- All code comments and documentation should be written in Chinese

## Common Patterns

### File Operations
```typescript
// 使用异步文件操作
const content = await vscode.workspace.fs.readFile(uri);
const text = new TextDecoder().decode(content);
```

### Command Registration
```typescript
context.subscriptions.push(
    vscode.commands.registerCommand('command.id', async () => {
        // 命令实现
    })
);
```

### User Input
```typescript
// 使用 VS Code 内置的选择器和对话框
const result = await vscode.window.showQuickPick(options);
```

### Error Handling
```typescript
try {
    // 执行操作
} catch (error) {
    vscode.window.showErrorMessage(`错误: ${error.message}`);
}
```

## Dependencies
- `fast-xml-parser` - For parsing IntelliJ XML files
- `path-browserify` - For cross-platform path handling
- VS Code extension API - For VS Code integration

## Build & Development
- Use `npm run compile` to build the extension
- Use `npm run watch` for development with auto-rebuild
- Use `npm run package` for production builds
- Use `npm run lint` to check code quality

## Key Files to Understand
- `src/extension.ts` - Main extension entry point
- `src/importer/syntax-analyzer/IntelliJSyntaxAnalyzer.ts` - Core conversion logic
- `src/importer/model/` - Data structures and interfaces
- `package.json` - Extension configuration and dependencies

## Notes
- The project supports both Node.js and web environments
- Maintain backward compatibility with existing keybinding formats
- Consider performance when processing large keymap files
- Follow VS Code extension marketplace guidelines for publishing
- **重要**: 所有用户界面文本、错误消息、注释和文档都应使用中文